<div class="modal-body">
    
    <div class="row mb-3">
        <div class="col-md-6">
            <h4 class="text-success">{{ producto_maestro.nombre_producto }}</h4>
            <p><strong>Descripción:</strong> {{ producto_maestro.descripcion_producto|default:"N/A" }}</p>
            <p><strong>Categoría:</strong> {{ producto_maestro.categoria_idcategoria.nombre_categoria }}</p>
            <p><strong>Proveedor Base:</strong> {{ producto_maestro.proveedor_idproveedor.nombre_proveedor }}</p>
        </div>
        <div class="col-md-6 text-right">
             <p><strong>Stock Total:</strong> <span class="badge badge-primary badge-lg">{{ stock_total }}</span> Unidades</p>
             <p><strong>Precio de Venta:</strong> <span class="badge badge-success badge-lg">$ {{ producto_maestro.precio_venta|floatformat:2 }}</span></p>
             <p><strong>Margen:</strong> {{ producto_maestro.margen_ganancia|floatformat:2 }}%</p>
        </div>
    </div>
    
    <hr>

    <h5 class="mt-3 mb-3"><i class="icon ion-md-cube mr-2"></i> Inventario Detallado por Lote</h5>
    <div class="table-responsive">
        <table class="table table-bordered table-sm table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Lote</th>
                    <th class="text-center">Stock</th>
                    <th>Vencimiento</th>
                    <th>Costo Compra</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for lote in lotes %}
                <tr {% if lote.stock_actual <= 0 %}class="table-danger" title="Lote Agotado"{% elif lote.stock_actual <= lote.stock_minimo %}class="table-warning" title="Stock Bajo"{% endif %}>
                    <td class="font-weight-bold">{{ lote.codigo_barras }}</td>
                    <td class="text-center">
                        <b>{{ lote.stock_actual }}</b>
                        {% if lote.stock_actual <= lote.stock_minimo and lote.stock_actual > 0 %}
                            <span class="badge badge-warning">Bajo</span>
                        {% elif lote.stock_actual <= 0 %}
                            <span class="badge badge-danger">Agotado</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if lote.fecha_vencimiento %}
                            {{ lote.fecha_vencimiento|date:"Y-m-d" }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>$ {{ lote.precio_compra|floatformat:2 }}</td>
                    <td>
                        <a href="{% url 'pre_editar_producto' lote.id %}" 
                           class="btn btn-warning btn-sm" 
                           title="Editar Stock del Lote">
                            <i class="icon ion-md-create"></i> Editar
                        </a>
                        
                        <a href="{% url 'eliminar_producto' lote.id %}" 
                           class="btn btn-danger btn-sm" 
                           title="Eliminar Lote"
                           onclick="return confirm('¿Estás SEGURO de eliminar el LOTE {{ lote.codigo_barras }}?');">
                            <i class="icon ion-md-trash"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted">No hay lotes activos.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <hr>

    <h5 class="mt-3 mb-3"><i class="icon ion-md-list mr-2"></i> Últimos Movimientos</h5>
    <div class="table-responsive">
        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Cantidad</th>
                    <th>Observaciones</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in movimientos %}
                <tr>
                    <td>{{ mov.fecha_movimiento|date:"Y-m-d H:i" }}</td>
                    <td><span class="badge badge-secondary">{{ mov.tipo_movimiento|capfirst }}</span></td>
                    <td>{{ mov.cantidad }}</td>
                    <td>{{ mov.observaciones|truncatechars:50 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center text-muted">Sin movimientos registrados</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
